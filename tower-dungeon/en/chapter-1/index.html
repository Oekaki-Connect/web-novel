<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 1: The Sovereign's Secret Sin</title>
    <link rel="stylesheet" href="../../../static/style.css">
    
    <!-- SEO Meta Tags -->
    
    <meta name="description" content="Tower Dungeon Chapter 1 - The Sovereign's Secret Sin. Read the thrilling manga adventure!">
    
    
    <meta name="keywords" content="chapter 1, tower dungeon, manga, adventure">
    
    
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Chapter 1: The Sovereign's Secret Sin | Web Novel Collection">
    <meta property="og:description" content="Chapter 1: The Sovereign's Secret Sin - The adventure begins!">
    <meta property="og:image" content="https://oekaki-connect.github.io/web-novel/static/images/tower-dungeon/chapter-1/page01.png">
    <meta property="og:url" content="https://oekaki-connect.github.io/web-novel/tower-dungeon/en/chapter-1/">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Web Novel Collection">
    
    <meta property="article:published_time" content="2025-01-25">
    
    
    <meta property="article:author" content="Manga Artist">
    
    
    
    <meta property="article:tag" content="action">
    
    <meta property="article:tag" content="mystery">
    
    <meta property="article:tag" content="fantasy">
    
    <meta property="article:tag" content="adventure">
    
    
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Chapter 1: The Sovereign's Secret Sin | Web Novel Collection">
    <meta name="twitter:description" content="Chapter 1: The Sovereign's Secret Sin - The adventure begins!">
    <meta name="twitter:image" content="https://oekaki-connect.github.io/web-novel/static/images/tower-dungeon/chapter-1/page01.png">
    
    <meta name="twitter:site" content="@your_twitter_handle">
    <meta name="twitter:creator" content="@your_twitter_handle">
    
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://oekaki-connect.github.io/web-novel/tower-dungeon/en/chapter-1/">
    
    <!-- Theme Toggle Script -->
    <script src="../../../static/theme-toggle.js"></script>
    
    <!-- Chapter Navigation Script -->
    <script>
        function jumpToChapter() {
            const select = document.getElementById('chapter-select');
            if (select.value) {
                window.location.href = select.value;
            }
        }
        
        // Reading settings functionality
        let currentTextSize = 100;
        let currentLineSpacing = 1.6;
        
        function loadReadingSettings() {
            const savedTextSize = localStorage.getItem('readingTextSize');
            const savedLineSpacing = localStorage.getItem('readingLineSpacing');
            
            if (savedTextSize) {
                currentTextSize = parseInt(savedTextSize);
                applyTextSize();
            }
            
            if (savedLineSpacing) {
                currentLineSpacing = parseFloat(savedLineSpacing);
                applyLineSpacing();
            }
            
            updateDisplays();
        }
        
        function adjustTextSize(delta) {
            currentTextSize = Math.max(70, Math.min(200, currentTextSize + (delta * 10)));
            applyTextSize();
            localStorage.setItem('readingTextSize', currentTextSize);
            updateDisplays();
        }
        
        function adjustLineSpacing(delta) {
            currentLineSpacing = Math.max(1.0, Math.min(3.0, currentLineSpacing + delta));
            applyLineSpacing();
            localStorage.setItem('readingLineSpacing', currentLineSpacing);
            updateDisplays();
        }
        
        function applyTextSize() {
            // Set CSS custom property on the root document for text size
            document.documentElement.style.setProperty('--reading-font-size', (currentTextSize / 100) + 'rem');
        }
        
        function applyLineSpacing() {
            // Set CSS custom property on the root document for line spacing
            document.documentElement.style.setProperty('--reading-line-height', currentLineSpacing);
        }
        
        function updateDisplays() {
            document.getElementById('text-size-display').textContent = currentTextSize + '%';
            document.getElementById('line-spacing-display').textContent = currentLineSpacing.toFixed(1);
        }
        
        function resetReadingSettings() {
            currentTextSize = 100;
            currentLineSpacing = 1.6;
            applyTextSize();
            applyLineSpacing();
            localStorage.removeItem('readingTextSize');
            localStorage.removeItem('readingLineSpacing');
            updateDisplays();
        }
        
        // Load settings when page loads
        document.addEventListener('DOMContentLoaded', loadReadingSettings);
        
        // Reading progress tracking
        function initReadingProgress() {
            const novelSlug = 'tower-dungeon';
            const chapterId = 'chapter-1';
            const chapterTitle = 'Chapter 1: The Sovereign's Secret Sin';
            
            // Mark this chapter as visited
            markChapterVisited(novelSlug, chapterId, chapterTitle);
            
            // Set up scroll tracking for completion
            setupScrollTracking(novelSlug, chapterId);
        }
        
        function markChapterVisited(novelSlug, chapterId, chapterTitle) {
            const visitedKey = `visited_${novelSlug}`;
            let visitedChapters = JSON.parse(localStorage.getItem(visitedKey) || '{}');
            
            visitedChapters[chapterId] = {
                title: chapterTitle,
                visitedAt: new Date().toISOString(),
                completed: visitedChapters[chapterId]?.completed || false
            };
            
            localStorage.setItem(visitedKey, JSON.stringify(visitedChapters));
        }
        
        function markChapterCompleted(novelSlug, chapterId) {
            const visitedKey = `visited_${novelSlug}`;
            let visitedChapters = JSON.parse(localStorage.getItem(visitedKey) || '{}');
            
            if (visitedChapters[chapterId]) {
                visitedChapters[chapterId].completed = true;
                visitedChapters[chapterId].completedAt = new Date().toISOString();
                localStorage.setItem(visitedKey, JSON.stringify(visitedChapters));
                
                // Update latest chapter read
                const latestKey = `latest_${novelSlug}`;
                localStorage.setItem(latestKey, JSON.stringify({
                    chapterId: chapterId,
                    title: visitedChapters[chapterId].title,
                    completedAt: visitedChapters[chapterId].completedAt
                }));
            }
        }
        
        function setupScrollTracking(novelSlug, chapterId) {
            let hasScrolledToEnd = false;
            
            function checkScrollProgress() {
                if (hasScrolledToEnd) return;
                
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                const windowHeight = window.innerHeight;
                const documentHeight = document.documentElement.scrollHeight;
                
                // Consider chapter "completed" when user scrolls to within 100px of the bottom
                const scrolledToEnd = (scrollTop + windowHeight) >= (documentHeight - 100);
                
                if (scrolledToEnd) {
                    hasScrolledToEnd = true;
                    markChapterCompleted(novelSlug, chapterId);
                }
            }
            
            window.addEventListener('scroll', checkScrollProgress);
            window.addEventListener('resize', checkScrollProgress);
            
            // Also check on load in case content is short
            setTimeout(checkScrollProgress, 1000);
        }
        
        // Initialize reading progress tracking
        document.addEventListener('DOMContentLoaded', initReadingProgress);
        
        // Keyboard navigation support
        function initKeyboardNavigation() {
            document.addEventListener('keydown', function(e) {
                // Skip if user is typing in an input field
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    return;
                }
                
                // Skip if any modifier keys are pressed (except Shift for some cases)
                if (e.ctrlKey || e.metaKey || e.altKey) {
                    return;
                }
                
                switch(e.key) {
                    case 'ArrowLeft':
                    case 'h':
                        // Previous chapter
                        
                        e.preventDefault();
                        break;
                        
                    case 'ArrowRight':
                    case 'l':
                        // Next chapter
                        
                        e.preventDefault();
                        break;
                        
                    case 'ArrowUp':
                    case 'k':
                        // Scroll up
                        window.scrollBy(0, -100);
                        e.preventDefault();
                        break;
                        
                    case 'ArrowDown':
                    case 'j':
                        // Scroll down
                        window.scrollBy(0, 100);
                        e.preventDefault();
                        break;
                        
                    case 'Home':
                    case 'g':
                        // Go to top
                        window.scrollTo(0, 0);
                        e.preventDefault();
                        break;
                        
                    case 'End':
                    case 'G':
                        // Go to bottom
                        window.scrollTo(0, document.body.scrollHeight);
                        e.preventDefault();
                        break;
                        
                    case 't':
                        // Go to table of contents
                        const tocLink = document.querySelector('nav.chapter-nav a[href*="toc"]');
                        if (tocLink) {
                            window.location.href = tocLink.href;
                        }
                        e.preventDefault();
                        break;
                        
                    case '=':
                    case '+':
                        // Increase text size
                        adjustTextSize(1);
                        e.preventDefault();
                        break;
                        
                    case '-':
                        // Decrease text size
                        adjustTextSize(-1);
                        e.preventDefault();
                        break;
                        
                    case '0':
                        // Reset reading settings
                        resetReadingSettings();
                        e.preventDefault();
                        break;
                        
                    case '?':
                        // Show help modal
                        showKeyboardHelp();
                        e.preventDefault();
                        break;
                }
            });
        }
        
        function showKeyboardHelp() {
            const existingModal = document.getElementById('keyboard-help-modal');
            if (existingModal) {
                existingModal.style.display = 'block';
                existingModal.querySelector('.help-close').focus();
                return;
            }
            
            const modal = document.createElement('div');
            modal.id = 'keyboard-help-modal';
            modal.className = 'keyboard-help-modal';
            modal.innerHTML = `
                <div class="help-content">
                    <div class="help-header">
                        <h3>Keyboard Shortcuts</h3>
                        <button class="help-close" aria-label="Close help">&times;</button>
                    </div>
                    <div class="help-body">
                        <div class="help-section">
                            <h4>Navigation</h4>
                            <ul>
                                <li><kbd>←</kbd> or <kbd>h</kbd> - Previous chapter</li>
                                <li><kbd>→</kbd> or <kbd>l</kbd> - Next chapter</li>
                                <li><kbd>t</kbd> - Table of contents</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Scrolling</h4>
                            <ul>
                                <li><kbd>↑</kbd> or <kbd>k</kbd> - Scroll up</li>
                                <li><kbd>↓</kbd> or <kbd>j</kbd> - Scroll down</li>
                                <li><kbd>Home</kbd> or <kbd>g</kbd> - Go to top</li>
                                <li><kbd>End</kbd> or <kbd>G</kbd> - Go to bottom</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Reading Settings</h4>
                            <ul>
                                <li><kbd>+</kbd> or <kbd>=</kbd> - Increase text size</li>
                                <li><kbd>-</kbd> - Decrease text size</li>
                                <li><kbd>0</kbd> - Reset all settings</li>
                            </ul>
                        </div>
                        <div class="help-section">
                            <h4>Help</h4>
                            <ul>
                                <li><kbd>?</kbd> - Show this help</li>
                                <li><kbd>Esc</kbd> - Close help/modals</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="help-overlay"></div>
            `;
            
            document.body.appendChild(modal);
            
            // Focus the close button
            const closeBtn = modal.querySelector('.help-close');
            closeBtn.focus();
            
            // Close handlers
            closeBtn.addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.querySelector('.help-overlay').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            document.addEventListener('keydown', function escHandler(e) {
                if (e.key === 'Escape') {
                    document.body.removeChild(modal);
                    document.removeEventListener('keydown', escHandler);
                }
            });
        }
        
        // Initialize keyboard navigation
        document.addEventListener('DOMContentLoaded', initKeyboardNavigation);
    </script>
    
    
</head>
<body>
    <header>
        <nav class="breadcrumbs" aria-label="Breadcrumb">
            <a href="../../../">Home</a>
            <span class="breadcrumb-separator">></span>
            <a href="../toc/">Tower Dungeon</a>
            <span class="breadcrumb-separator">></span>
            <span class="current-page">Chapter 1: The Sovereign's Secret Sin</span>
        </nav>
        <nav class="chapter-nav" aria-label="Chapter navigation">
            
            <a href="../toc/">Table of Contents</a>
            
        </nav>
        
        <div class="chapter-dropdown" role="group" aria-label="Chapter selection">
            <label for="chapter-select">Jump to Chapter:</label>
            <select id="chapter-select" onchange="jumpToChapter()" aria-label="Jump to chapter">
                <option value="">Select a chapter...</option>
                
                    <optgroup label="Volume 1: The Tower's Secret">
                        
                            <option value="../chapter-1/" selected>
                                Chapter 1: The Sovereign's Secret Sin
                            </option>
                        
                    </optgroup>
                
            </select>
        </div>
        
        <div class="reading-config" role="group" aria-label="Reading settings">
            <details>
                <summary>Reading Settings</summary>
                <div class="reading-controls">
                    <div class="control-group">
                        <label for="text-size">Text Size:</label>
                        <div class="button-group">
                            <button onclick="adjustTextSize(-1)">A-</button>
                            <span id="text-size-display">100%</span>
                            <button onclick="adjustTextSize(1)">A+</button>
                        </div>
                    </div>
                    <div class="control-group">
                        <label for="line-spacing">Line Spacing:</label>
                        <div class="button-group">
                            <button onclick="adjustLineSpacing(-0.1)">-</button>
                            <span id="line-spacing-display">1.6</span>
                            <button onclick="adjustLineSpacing(0.1)">+</button>
                        </div>
                    </div>
                    <button onclick="resetReadingSettings()" class="reset-button">Reset to Default</button>
                </div>
            </details>
        </div>
        
        <h1>Chapter 1: The Sovereign's Secret Sin</h1>
        
        
        <div class="chapter-metadata">
            
            <div class="metadata-item">
                <strong>Author:</strong> 
                
                
                Manga Artist
                
            </div>
            
            
            
            
            
            <div class="metadata-item">
                <strong>Published:</strong> 2025-01-25
            </div>
            
            
            
            <div class="metadata-item">
                <strong>Tags:</strong>
                <div class="tags">
                    
                    <a href="../tags/action/" class="tag">action</a>
                    
                    <a href="../tags/mystery/" class="tag">mystery</a>
                    
                    <a href="../tags/fantasy/" class="tag">fantasy</a>
                    
                    <a href="../tags/adventure/" class="tag">adventure</a>
                    
                </div>
            </div>
            
            
            
        </div>
        
    </header>
    <main>
        
        
        
        
        
        <!-- Manga Reader -->
        <div id="manga-reader" class="manga-reader">
            <div class="manga-controls">
                <div class="manga-controls-left">
                    <span class="page-indicator">
                        Page <span id="current-page">1</span> of <span id="total-pages">10</span>
                    </span>
                </div>
                
                <div class="manga-controls-center">
                    <button id="prev-page" class="manga-btn" aria-label="Previous page">
                        <span>◀</span>
                    </button>
                    <button id="next-page" class="manga-btn" aria-label="Next page">
                        <span>▶</span>
                    </button>
                </div>
                
                <div class="manga-controls-right">
                    <button id="zoom-fit-btn" class="manga-btn" aria-label="Zoom to fit viewport">
                        <span>⤢</span>
                    </button>
                    <button id="fullscreen-btn" class="manga-btn" aria-label="Toggle fullscreen">
                        <span>⛶</span>
                    </button>
                    <button id="manga-settings-btn" class="manga-btn" aria-label="Reader settings">
                        <span>⚙</span>
                    </button>
                </div>
            </div>
            
            <div class="manga-viewer" id="manga-viewer">
                
                <div class="manga-page" data-page="1" >
                    <img src="../../../images/tower-dungeon/chapter-1/page01.png" alt="Tower Dungeon Chapter 1, Page 1" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="2" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page02.png" alt="Tower Dungeon Chapter 1, Page 2" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="3" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page03.png" alt="Tower Dungeon Chapter 1, Page 3" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="4" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page04.png" alt="Tower Dungeon Chapter 1, Page 4" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="5" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page05.png" alt="Tower Dungeon Chapter 1, Page 5" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="6" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page06.png" alt="Tower Dungeon Chapter 1, Page 6" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="7" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page07.png" alt="Tower Dungeon Chapter 1, Page 7" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="8" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page08.png" alt="Tower Dungeon Chapter 1, Page 8" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="9" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page09.png" alt="Tower Dungeon Chapter 1, Page 9" class="manga-image" loading="lazy">
                </div>
                
                <div class="manga-page" data-page="10" style="display: none;">
                    <img src="../../../images/tower-dungeon/chapter-1/page10.png" alt="Tower Dungeon Chapter 1, Page 10" class="manga-image" loading="lazy">
                </div>
                
            </div>
        </div>
        
        <!-- Manga Settings Modal -->
        <div id="manga-settings-modal" class="manga-settings-modal" style="display: none;">
            <div class="manga-settings-content">
                <h3>Reader Settings</h3>
                
                <div class="setting-group">
                    <label for="view-mode">View Mode:</label>
                    <select id="view-mode">
                        <option value="single">Single Page</option>
                        <option value="double">Double Page</option>
                        <option value="scroll">Vertical Scroll</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="image-scaling">Image Scaling:</label>
                    <select id="image-scaling">
                        <option value="fit_screen">Fit Screen</option>
                        <option value="fit_width">Fit Width</option>
                        <option value="original">Original Size</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <label for="zoom-level">Zoom: <span id="zoom-display">100%</span></label>
                    <input type="range" id="zoom-level" min="50" max="300" step="20" value="100">
                </div>
                
                <div class="setting-group">
                    <label for="preload-images">Image Preloading:</label>
                    <select id="preload-images">
                        <option value="0">Disabled</option>
                        <option value="1">1 Image</option>
                        <option value="2">2 Images</option>
                        <option value="3" selected>3 Images</option>
                        <option value="4">4 Images</option>
                        <option value="5">5 Images</option>
                    </select>
                </div>
                
                <div class="setting-group">
                    <button id="reset-settings" class="manga-btn">Reset to Defaults</button>
                </div>
                
                <div class="setting-group">
                    <button id="close-settings" class="manga-btn manga-btn-primary">Close</button>
                </div>
            </div>
        </div>
        
        <script>
            // Manga reader functionality
            const mangaData = {"config": {"cover_separate": true, "image_scaling": "fit_screen", "page_turn_area": "right_half", "preload_pages": 3, "reading_direction": "ltr", "view_mode": "single", "zoom_level": 100}, "page_count": 10, "pages": [{"alt_text": "Tower Dungeon Chapter 1, Page 1", "filename": "page01.png", "number": 1, "path": "../../../images/tower-dungeon/chapter-1/page01.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 2", "filename": "page02.png", "number": 2, "path": "../../../images/tower-dungeon/chapter-1/page02.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 3", "filename": "page03.png", "number": 3, "path": "../../../images/tower-dungeon/chapter-1/page03.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 4", "filename": "page04.png", "number": 4, "path": "../../../images/tower-dungeon/chapter-1/page04.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 5", "filename": "page05.png", "number": 5, "path": "../../../images/tower-dungeon/chapter-1/page05.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 6", "filename": "page06.png", "number": 6, "path": "../../../images/tower-dungeon/chapter-1/page06.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 7", "filename": "page07.png", "number": 7, "path": "../../../images/tower-dungeon/chapter-1/page07.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 8", "filename": "page08.png", "number": 8, "path": "../../../images/tower-dungeon/chapter-1/page08.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 9", "filename": "page09.png", "number": 9, "path": "../../../images/tower-dungeon/chapter-1/page09.png"}, {"alt_text": "Tower Dungeon Chapter 1, Page 10", "filename": "page10.png", "number": 10, "path": "../../../images/tower-dungeon/chapter-1/page10.png"}]};
            let currentPage = 1;
            let viewMode = 'single';
            let imageScaling = 'fit_screen';
            let zoomLevel = 100;
            let readingDirection = 'ltr';
            let preloadImages = 3; // Default to 3 images
            let isFullscreen = false;
            let mouseTimer = null;
            const preloadedImages = new Map(); // Cache for preloaded images
            
            document.addEventListener('DOMContentLoaded', function() {
                initMangaReader();
                setupMangaKeyboardControls();
                loadMangaSettings();
                applyMangaSettings();
                setupFullscreenMode();
                setupPageCompletionTracking();
            });
            
            function preloadUpcomingImages() {
                if (preloadImages === 0) return; // Preloading disabled
                
                const totalPages = mangaData.page_count;
                
                // Preload upcoming pages
                for (let i = 1; i <= preloadImages; i++) {
                    const nextPage = currentPage + i;
                    if (nextPage <= totalPages) {
                        preloadImage(nextPage);
                    }
                }
            }
            
            function preloadImage(pageNumber) {
                const pageKey = `page${pageNumber}`;
                
                // Skip if already preloaded
                if (preloadedImages.has(pageKey)) return;
                
                // Find the page data
                const pageData = mangaData.pages.find(p => p.page_number === pageNumber);
                if (!pageData) return;
                
                // Create and preload the image
                const img = new Image();
                img.onload = () => {
                    preloadedImages.set(pageKey, img);
                    console.log(`Preloaded page ${pageNumber}`);
                };
                img.onerror = () => {
                    console.warn(`Failed to preload page ${pageNumber}`);
                };
                
                img.src = pageData.url;
            }
            
            function initMangaReader() {
                // Update UI
                updatePageIndicator();
                
                // Start preloading images for current page
                preloadUpcomingImages();
                
                // Event listeners
                document.getElementById('prev-page').addEventListener('click', () => changePage(-1));
                document.getElementById('next-page').addEventListener('click', () => changePage(1));
                document.getElementById('zoom-fit-btn').addEventListener('click', zoomToFit);
                document.getElementById('fullscreen-btn').addEventListener('click', toggleFullscreen);
                document.getElementById('manga-settings-btn').addEventListener('click', toggleSettings);
                document.getElementById('close-settings').addEventListener('click', toggleSettings);
                
                // Settings controls
                document.getElementById('view-mode').addEventListener('change', (e) => {
                    viewMode = e.target.value;
                    saveMangaSettings();
                    applyMangaSettings();
                });
                
                document.getElementById('image-scaling').addEventListener('change', (e) => {
                    imageScaling = e.target.value;
                    saveMangaSettings();
                    applyMangaSettings();
                });
                
                document.getElementById('zoom-level').addEventListener('input', (e) => {
                    zoomLevel = parseInt(e.target.value);
                    document.getElementById('zoom-display').textContent = zoomLevel + '%';
                    saveMangaSettings();
                    applyMangaSettings();
                });
                
                document.getElementById('preload-images').addEventListener('change', (e) => {
                    preloadImages = parseInt(e.target.value);
                    saveMangaSettings();
                    // Clear existing preload cache when settings change
                    preloadedImages.clear();
                    // Trigger preloading for current page
                    preloadUpcomingImages();
                });
                
                document.getElementById('reset-settings').addEventListener('click', resetMangaSettings);
                
                // Click areas for page turning
                const viewer = document.getElementById('manga-viewer');
                viewer.addEventListener('click', handleViewerClick);
            }
            
            function changePage(direction) {
                const newPage = currentPage + direction;
                if (newPage >= 1 && newPage <= mangaData.page_count) {
                    showPage(newPage);
                }
            }
            
            function showPage(pageNum) {
                // Hide current page
                const currentPageEl = document.querySelector(`.manga-page[data-page="${currentPage}"]`);
                if (currentPageEl) {
                    currentPageEl.style.display = 'none';
                }
                
                // Show new page
                const newPageEl = document.querySelector(`.manga-page[data-page="${pageNum}"]`);
                if (newPageEl) {
                    newPageEl.style.display = 'block';
                    currentPage = pageNum;
                    updatePageIndicator();
                    
                    // Scroll to top of page
                    newPageEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    
                    // Preload upcoming images
                    preloadUpcomingImages();
                }
            }
            
            function updatePageIndicator() {
                document.getElementById('current-page').textContent = currentPage;
                document.getElementById('total-pages').textContent = mangaData.page_count;
                
                // Update navigation button states
                document.getElementById('prev-page').disabled = currentPage === 1;
                document.getElementById('next-page').disabled = currentPage === mangaData.page_count;
            }
            
            function toggleSettings() {
                const modal = document.getElementById('manga-settings-modal');
                const isVisible = modal.style.display !== 'none';
                modal.style.display = isVisible ? 'none' : 'block';
                
                if (!isVisible) {
                    // Update controls to current values
                    document.getElementById('view-mode').value = viewMode;
                    document.getElementById('image-scaling').value = imageScaling;
                    document.getElementById('zoom-level').value = zoomLevel;
                    document.getElementById('zoom-display').textContent = zoomLevel + '%';
                    document.getElementById('preload-images').value = preloadImages;
                }
            }
            
            function handleViewerClick(e) {
                const rect = e.currentTarget.getBoundingClientRect();
                const clickX = e.clientX - rect.left;
                const width = rect.width;
                
                if (clickX < width * 0.3) {
                    // Left third - previous page
                    changePage(-1);
                } else if (clickX > width * 0.7) {
                    // Right third - next page
                    changePage(1);
                }
                // Middle third - no action (for UI controls)
            }
            
            function setupMangaKeyboardControls() {
                document.addEventListener('keydown', function(e) {
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT') {
                        return; // Don't interfere with form inputs
                    }
                    
                    switch(e.key) {
                        case 'ArrowLeft':
                        case 'a':
                        case 'A':
                            e.preventDefault();
                            changePage(-1);
                            break;
                        case 'ArrowRight':
                        case 'd':
                        case 'D':
                            e.preventDefault();
                            changePage(1);
                            break;
                        case 'Home':
                            e.preventDefault();
                            showPage(1);
                            break;
                        case 'End':
                            e.preventDefault();
                            showPage(mangaData.page_count);
                            break;
                        case 'Escape':
                            toggleSettings();
                            break;
                    }
                });
            }
            
            function loadMangaSettings() {
                const saved = localStorage.getItem('manga-reader-settings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    viewMode = settings.viewMode || viewMode;
                    imageScaling = settings.imageScaling || imageScaling;
                    zoomLevel = settings.zoomLevel || zoomLevel;
                    preloadImages = settings.preloadImages !== undefined ? settings.preloadImages : preloadImages;
                }
            }
            
            function saveMangaSettings() {
                const settings = {
                    viewMode,
                    imageScaling,
                    zoomLevel,
                    preloadImages
                };
                localStorage.setItem('manga-reader-settings', JSON.stringify(settings));
            }
            
            function applyMangaSettings() {
                const viewer = document.getElementById('manga-viewer');
                const images = viewer.querySelectorAll('.manga-image');
                
                // Apply view mode
                applyViewMode();
                
                // Apply scaling
                images.forEach(img => {
                    img.style.transform = `scale(${zoomLevel / 100})`;
                    
                    switch(imageScaling) {
                        case 'fit_screen':
                            img.style.maxWidth = '100vw';
                            img.style.maxHeight = '100vh';
                            img.style.width = 'auto';
                            img.style.height = 'auto';
                            break;
                        case 'fit_width':
                            img.style.maxWidth = '100%';
                            img.style.maxHeight = 'none';
                            img.style.width = '100%';
                            img.style.height = 'auto';
                            break;
                        case 'original':
                            img.style.maxWidth = 'none';
                            img.style.maxHeight = 'none';
                            img.style.width = 'auto';
                            img.style.height = 'auto';
                            break;
                    }
                });
            }
            
            function resetMangaSettings() {
                viewMode = 'single';
                imageScaling = 'fit_screen';
                zoomLevel = 100;
                preloadImages = 3; // Reset to default
                
                saveMangaSettings();
                applyMangaSettings();
                
                // Clear and restart preloading
                preloadedImages.clear();
                preloadUpcomingImages();
                
                // Update UI
                document.getElementById('view-mode').value = viewMode;
                document.getElementById('image-scaling').value = imageScaling;
                document.getElementById('zoom-level').value = zoomLevel;
                document.getElementById('zoom-display').textContent = zoomLevel + '%';
                document.getElementById('preload-images').value = preloadImages;
            }
            
            function toggleFullscreen() {
                const reader = document.getElementById('manga-reader');
                isFullscreen = !isFullscreen;
                
                if (isFullscreen) {
                    reader.classList.add('fullscreen');
                    setupFullscreenMouseEvents();
                    hideFullscreenControls();
                } else {
                    reader.classList.remove('fullscreen');
                    showFullscreenControls();
                    cleanupFullscreenMouseEvents();
                }
            }
            
            function setupFullscreenMode() {
                // ESC key handler for fullscreen
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && isFullscreen) {
                        toggleFullscreen();
                    }
                });
            }
            
            function setupFullscreenMouseEvents() {
                const controls = document.querySelector('.manga-controls');
                
                document.addEventListener('mousemove', handleFullscreenMouseMove);
                document.addEventListener('mouseleave', hideFullscreenControls);
            }
            
            function cleanupFullscreenMouseEvents() {
                document.removeEventListener('mousemove', handleFullscreenMouseMove);
                document.removeEventListener('mouseleave', hideFullscreenControls);
            }
            
            function handleFullscreenMouseMove(e) {
                const controls = document.querySelector('.manga-controls');
                
                // Show controls if mouse is near top of screen
                if (e.clientY < 100) {
                    showFullscreenControls();
                    
                    // Clear existing timer
                    if (mouseTimer) {
                        clearTimeout(mouseTimer);
                    }
                    
                    // Hide controls after 3 seconds of no movement
                    mouseTimer = setTimeout(() => {
                        hideFullscreenControls();
                    }, 3000);
                } else {
                    hideFullscreenControls();
                }
            }
            
            function showFullscreenControls() {
                const controls = document.querySelector('.manga-controls');
                if (isFullscreen) {
                    controls.classList.add('show');
                }
            }
            
            function hideFullscreenControls() {
                const controls = document.querySelector('.manga-controls');
                if (isFullscreen) {
                    controls.classList.remove('show');
                }
            }
            
            function zoomToFit() {
                const viewportHeight = window.innerHeight;
                const currentImage = document.querySelector(`.manga-page[data-page="${currentPage}"] .manga-image`);
                
                if (currentImage) {
                    // Calculate zoom to fit viewport height
                    const imageHeight = currentImage.naturalHeight;
                    const targetZoom = Math.floor((viewportHeight * 0.9 / imageHeight) * 100);
                    
                    zoomLevel = Math.max(50, Math.min(300, targetZoom));
                    
                    // Update UI and save settings
                    document.getElementById('zoom-level').value = zoomLevel;
                    document.getElementById('zoom-display').textContent = zoomLevel + '%';
                    saveMangaSettings();
                    applyMangaSettings();
                    
                    // Scroll to center the image
                    currentImage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }
            
            function setupPageCompletionTracking() {
                // Override the showPage function to track completion
                const originalShowPage = showPage;
                showPage = function(pageNum) {
                    originalShowPage(pageNum);
                    
                    // Mark as completed if this is the last page
                    if (pageNum === mangaData.page_count) {
                        markChapterCompleted('tower-dungeon', 'chapter-1');
                    }
                };
            }
            
            function applyViewMode() {
                const viewer = document.getElementById('manga-viewer');
                const pages = viewer.querySelectorAll('.manga-page');
                
                // Remove all view mode classes
                viewer.classList.remove('double-page', 'scroll-mode', 'original-size');
                
                switch(viewMode) {
                    case 'double':
                        viewer.classList.add('double-page');
                        setupDoublePage();
                        break;
                    case 'scroll':
                        viewer.classList.add('scroll-mode');
                        setupScrollMode();
                        break;
                    default:
                        setupSinglePage();
                        break;
                }
                
                if (imageScaling === 'original') {
                    viewer.classList.add('original-size');
                }
            }
            
            function setupSinglePage() {
                const pages = document.querySelectorAll('.manga-page');
                pages.forEach((page, index) => {
                    page.style.display = (index + 1 === currentPage) ? 'block' : 'none';
                    page.classList.remove('active', 'single-cover');
                });
            }
            
            function setupDoublePage() {
                const pages = document.querySelectorAll('.manga-page');
                const coverSeparate = true;
                
                pages.forEach(page => {
                    page.style.display = 'none';
                    page.classList.remove('active', 'single-cover');
                });
                
                if (currentPage === 1 && coverSeparate) {
                    // Show first page alone
                    const firstPage = document.querySelector('.manga-page[data-page="1"]');
                    if (firstPage) {
                        firstPage.style.display = 'block';
                        firstPage.classList.add('active', 'single-cover');
                    }
                } else {
                    // Show two pages side by side
                    const startPage = coverSeparate ? 
                        (currentPage === 1 ? 1 : (currentPage % 2 === 0 ? currentPage : currentPage - 1)) :
                        (currentPage % 2 === 1 ? currentPage : currentPage - 1);
                    
                    for (let i = 0; i < 2; i++) {
                        const pageNum = startPage + i;
                        if (pageNum <= mangaData.page_count) {
                            const page = document.querySelector(`.manga-page[data-page="${pageNum}"]`);
                            if (page) {
                                page.style.display = 'block';
                                page.classList.add('active');
                            }
                        }
                    }
                }
            }
            
            function setupScrollMode() {
                const pages = document.querySelectorAll('.manga-page');
                pages.forEach(page => {
                    page.style.display = 'block';
                    page.classList.remove('active', 'single-cover');
                });
            }
        </script>
        
        
        
        
        <!-- Chapter Navigation -->
        <nav class="chapter-nav-bottom" aria-label="Bottom chapter navigation">
            
            <a href="../toc/">Table of Contents</a>
            
        </nav>
        
        
        <div class="comments-section">
            <h3>Comments</h3>
            <div id="utterances-container" 
                 data-repo="Oekaki-Connect/web-novel-utterance-comments"
                 data-issue-term="pathname"
                 data-label="utterance-comment">
            </div>
        </div>
        
    </main>
    <footer>
        <nav aria-label="Footer navigation">
            
            <a href="../toc/">Table of Contents</a>
            
        </nav>
        <p>© 2025 Web Novel Collection</p>
        
        <nav class="footer-links" aria-label="Footer links">
            
            <a href="https://ko-fi.com/mangaartist" target="_blank">Support the Artist</a>
            
            <a href="https://example.com/tower-dungeon" target="_blank">Original Source</a>
            
            <a href="https://www.oekakiconnect.net/" target="_blank">Oekaki Connect</a>
            
            <a href="https://www.oekaki.io/" target="_blank">Oekaki.io</a>
            
        </nav>
        
        
    </footer>
</body>
</html>
